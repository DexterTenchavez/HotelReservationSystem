@model HotelReservationSystem.Models.Room
@{
    ViewData["Title"] = "Add New Room";
    Layout = "~/Views/Shared/_LayoutWithSidebar.cshtml";
}

<div class="container-fluid">
    <div class="dashboard-header">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="text-white">
                    <i class="fas fa-plus-circle me-3"></i>Add New Room
                </h1>
                <p class="text-white mb-0">Create a new room for your hotel</p>
            </div>
            <div class="col-md-4 text-end">
                <a href="@Url.Action("RoomManagement", "Home")" class="btn btn-light btn-lg">
                    <i class="fas fa-arrow-left me-2"></i>Back to Rooms
                </a>
            </div>
        </div>
    </div>

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>@TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="m-0 font-weight-bold">
                        <i class="fas fa-bed me-2"></i>Room Information
                    </h5>
                </div>
                <div class="card-body">
                    <form asp-action="CreateRoom" method="post" enctype="multipart/form-data" id="createRoomForm">
                        @Html.AntiForgeryToken()

                        <div class="row">
                            <div class="col-12 mb-4">
                                <div class="image-upload-section">
                                    <label class="form-label fw-bold">Room Image</label>
                                    <div class="image-upload-container">
                                        <div class="image-preview mb-3 text-center">
                                            <img id="imagePreview" src="/images/placeholder-room.jpg"
                                                 alt="Room preview"
                                                 class="img-fluid rounded"
                                                 style="max-height: 250px; object-fit: cover;">
                                        </div>
                                        <div class="input-group">
                                            <input type="file" asp-for="ImageFile"
                                                   class="form-control"
                                                   id="imageInput"
                                                   accept="image/*"
                                                   onchange="previewImage(this)">
                                            <label class="input-group-text" for="imageInput">
                                                <i class="fas fa-cloud-upload-alt"></i>
                                            </label>
                                        </div>
                                        <small class="form-text text-muted">
                                            Upload a room image (JPG, PNG, JPEG). Max 5MB.
                                        </small>
                                        <span asp-validation-for="ImageFile" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="RoomNumber" class="form-label fw-bold">Room Number *</label>
                                    <input asp-for="RoomNumber" class="form-control" placeholder="e.g., 107, 207, 307" required />
                                    <span asp-validation-for="RoomNumber" class="text-danger"></span>
                                    <small class="form-text text-muted">Unique room identifier</small>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="RoomType" class="form-label fw-bold">Room Type *</label>
                                    <select asp-for="RoomType" class="form-select" required>
                                        <option value="">Select Room Type</option>
                                        <option value="Single">Single Room</option>
                                        <option value="Double">Double Room</option>
                                        <option value="Suite">Luxury Suite</option>
                                    </select>
                                    <span asp-validation-for="RoomType" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="PricePerNight" class="form-label fw-bold">Price Per Night (₱) *</label>
                                    <input asp-for="PricePerNight" type="number" step="0.01" min="0"
                                           class="form-control" placeholder="1000.00" required />
                                    <span asp-validation-for="PricePerNight" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="MaxGuests" class="form-label fw-bold">Maximum Guests *</label>
                                    <input asp-for="MaxGuests" type="number" min="1" max="10"
                                           class="form-control" placeholder="2" required />
                                    <span asp-validation-for="MaxGuests" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="mb-3">
                                    <label asp-for="Description" class="form-label fw-bold">Room Description</label>
                                    <textarea asp-for="Description" class="form-control" rows="4"
                                              placeholder="Describe the room features, amenities, view, etc."></textarea>
                                    <span asp-validation-for="Description" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="mb-3">
                                    <label asp-for="Features" class="form-label fw-bold">Room Features</label>
                                    <textarea asp-for="Features" class="form-control" rows="3"
                                              placeholder="List key features (e.g., Free WiFi, Air Conditioning, TV, etc.)"></textarea>
                                    <span asp-validation-for="Features" class="text-danger"></span>
                                    <small class="form-text text-muted">Separate features with commas</small>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <a href="@Url.Action("RoomManagement", "Home")" class="btn btn-secondary me-md-2">
                                        <i class="fas fa-times me-1"></i>Cancel
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-1"></i>Create Room
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function previewImage(input) {
            const preview = document.getElementById('imagePreview');
            const file = input.files[0];

            if (file) {
                const reader = new FileReader();

                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                }

                reader.readAsDataURL(file);
            } else {
                preview.src = '/images/placeholder-room.jpg';
            }
        }

        document.getElementById('createRoomForm').addEventListener('submit', function(e) {
            const roomNumber = document.querySelector('#RoomNumber').value;
            const roomType = document.querySelector('#RoomType').value;
            const price = document.querySelector('#PricePerNight').value;

            if (!roomNumber || !roomType || !price) {
                e.preventDefault();
                alert('Please fill in all required fields.');
                return false;
            }

            const imageInput = document.getElementById('imageInput');
            if (imageInput.files.length > 0) {
                const fileSize = imageInput.files[0].size / 1024 / 1024;
                if (fileSize > 5) {
                    e.preventDefault();
                    alert('Image file size must be less than 5MB.');
                    return false;
                }
            }
        });

        document.querySelector('#RoomType').addEventListener('change', function() {
            const roomType = this.value;
            const descriptionField = document.querySelector('#Description');
            const priceField = document.querySelector('#PricePerNight');
            const maxGuestsField = document.querySelector('#MaxGuests');

            if (!descriptionField.value) {
                switch(roomType) {
                    case 'Single':
                        descriptionField.value = 'Cozy single room perfect for solo travelers. Features a comfortable single bed, work desk, and essential amenities.';
                        if (!priceField.value) priceField.value = '1000';
                        if (!maxGuestsField.value) maxGuestsField.value = '1';
                        break;
                    case 'Double':
                        descriptionField.value = 'Spacious double room ideal for couples or business travelers. Features a queen-size bed, seating area, and modern amenities.';
                        if (!priceField.value) priceField.value = '2000';
                        if (!maxGuestsField.value) maxGuestsField.value = '2';
                        break;
                    case 'Suite':
                        descriptionField.value = 'Luxurious suite offering premium comfort and space. Features separate living area, premium bedding, and exclusive amenities.';
                        if (!priceField.value) priceField.value = '3500';
                        if (!maxGuestsField.value) maxGuestsField.value = '4';
                        break;
                }
            }
        });
    </script>

    <style>
        .image-upload-section {
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

            .image-upload-section:hover {
                border-color: #4e73df;
                background: #f0f4ff;
            }

        .image-preview img {
            border: 3px solid #e9ecef;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

            .image-preview img:hover {
                border-color: #4e73df;
                transform: scale(1.02);
            }

        .form-control:focus, .form-select:focus {
            border-color: #4e73df;
            box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
        }
    </style>
}